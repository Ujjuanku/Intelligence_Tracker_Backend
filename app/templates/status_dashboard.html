{% extends "base.html" %}

{% block content %}
<div class="header-actions">
    <div>
        <h1>System Status</h1>
        <p class="subtitle">Operational Health Dashboard</p>
    </div>
    <a href="/" class="btn btn-secondary">Dashboard</a>
</div>

<div class="grid status-grid">
    <div class="card status-card">
        <div class="status-icon" id="be-icon">⏳</div>
        <h3>Backend</h3>
        <p class="status-text" id="be-status">Checking...</p>
    </div>

    <div class="card status-card">
        <div class="status-icon" id="db-icon">⏳</div>
        <h3>Database</h3>
        <p class="status-text" id="db-status">Checking...</p>
    </div>

    <div class="card status-card">
        <div class="status-icon" id="llm-icon">⏳</div>
        <h3>AI Engine</h3>
        <p class="status-text" id="llm-status">Checking...</p>
    </div>
</div>

<script>
    // Fetch JSON from existing /status API
    fetch('/status')
        .then(r => r.json())
        .then(data => {
            const setStatus = (id, state) => {
                const iconEl = document.getElementById(`${id}-icon`);
                const textEl = document.getElementById(`${id}-status`);

                if (state === 'ok' || state === 'connected') {
                    iconEl.textContent = '✅';
                    textEl.textContent = 'Operational';
                    textEl.className = 'status-text status-ok';
                } else if (state.includes('disconnected') || state.includes('error')) {
                    iconEl.textContent = '❌';
                    textEl.textContent = 'Offline';
                    textEl.className = 'status-text status-bad';
                } else {
                    iconEl.textContent = '⚠️';
                    textEl.textContent = state;
                    textEl.className = 'status-text status-unknown';
                }
            };

            setStatus('be', data.backend);
            setStatus('db', data.database);
            setStatus('llm', data.llm);
        })
        .catch(e => {
            console.error(e);
            document.querySelectorAll('.status-text').forEach(el => el.textContent = 'Error fetching status');
        });
</script>
{% endblock %}